plugins {
  id 'net.researchgate.release' version '2.1.0'
}

allprojects {
	apply plugin: 'java'
	apply plugin: 'eclipse'
	
	repositories {
		mavenCentral()
	}
}

task cleanUpVcsAndIcsFolders(type: Delete) {
	delete "${project.rootDir}/vcs"
	delete "${project.rootDir}/ics"
}

clean.dependsOn 'cleanUpVcsAndIcsFolders'


task copyTestFiles (type: Copy) {
	from "${project.rootDir}/src/test/resources/vcs"
	into "${project.rootDir}/vcs"
}

processTestResources.dependsOn 'copyTestFiles'

jar {
	archiveName = 'VCS2ICS.jar'
	manifest {
		attributes('Implementation-Title': project.name,
				'Implementation-Version': version,
				'Main-Class': 'net.sourceforge.users.dragomerlin.vcs2icsCalendarConverter.Main')
	}
}

release {
	tagTemplate = 'v$version'
}

dependencies {
	compile 'com.googlecode.juniversalchardet:juniversalchardet:1.0.3'
	compile 'commons-codec:commons-codec:1.7'
	compile 'commons-io:commons-io:2.4'
}
		
eclipse.classpath {
	file {
		beforeMerged { classpath -> 
			def jreEntries = classpath.entries.findAll { entry ->
				entry.kind.equals('con') &&
				entry.path.contains('org.eclipse.jdt.launching.JRE_CONTAINER')
			}
			classpath.entries.removeAll(jreEntries)
		}
	}
	if (JavaVersion.current() > targetCompatibility) {
		containers.remove('org.eclipse.jdt.launching.JRE_CONTAINER')
		containers "org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-$sourceCompatibility"
	}
}


eclipseJdt {
	enabled = false
}